<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öæ Moneyball Draft Challenge</title>
    <style>
        :root {
            --bg: #0d1117;
            --bg2: #161b22;
            --bg3: #1c2128;
            --border: #30363d;
            --text: #e6edf3;
            --muted: #7d8590;
            --gold: #f5a623;
            --gold-dim: rgba(245,166,35,0.15);
            --green: #3fb950;
            --green-dark: #238636;
            --red: #f85149;
            --blue: #58a6ff;
            --t: 0.3s ease;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed; inset: 0;
            background:
                radial-gradient(ellipse at 50% 0%, rgba(245,166,35,0.07) 0%, transparent 55%),
                radial-gradient(ellipse at 100% 100%, rgba(88,166,255,0.04) 0%, transparent 45%);
            pointer-events: none; z-index: 0;
        }
        .container { max-width: 960px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        header { text-align: center; padding: 28px 0 16px; }
        .header-ball {
            font-size: 2.8rem; display: block; margin-bottom: 10px;
            animation: spin 10s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        h1 {
            font-size: clamp(1.9rem, 5vw, 2.8rem);
            font-weight: 800; letter-spacing: -0.5px;
            background: linear-gradient(130deg, #fff 0%, var(--gold) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .header-sub { color: var(--muted); font-size: 0.92rem; margin-top: 5px; }

        /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
        .progress-wrap {
            margin: 22px 0;
            background: var(--bg2); border: 1px solid var(--border); border-radius: 14px;
            padding: 16px 24px;
        }
        .progress-track { display: flex; align-items: center; justify-content: center; }
        .p-node { display: flex; flex-direction: column; align-items: center; gap: 7px; flex: 1; max-width: 90px; }
        .p-circle {
            width: 28px; height: 28px; border-radius: 50%;
            border: 2px solid var(--border); background: var(--bg3);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.78rem; transition: all var(--t);
        }
        .p-circle.active  { border-color: var(--gold); background: var(--gold-dim); color: var(--gold); box-shadow: 0 0 14px rgba(245,166,35,0.25); }
        .p-circle.done    { border-color: var(--green); background: var(--green-dark); color: #fff; }
        .p-label { font-size: 0.62rem; color: var(--muted); text-align: center; line-height: 1.3; transition: color var(--t); }
        .p-label.active { color: var(--gold); }
        .p-label.done   { color: var(--green); }
        .p-line { flex: 1; height: 2px; background: var(--border); margin: 0 2px 20px; transition: background var(--t); }
        .p-line.done { background: var(--green); }

        /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
        .screen { display: none; opacity: 0; transform: translateY(14px); transition: opacity .35s ease, transform .35s ease; }
        .screen.active  { display: block; }
        .screen.visible { opacity: 1; transform: translateY(0); }

        /* ‚îÄ‚îÄ MISSION BOX ‚îÄ‚îÄ */
        .mission-box {
            background: var(--bg2); border: 1px solid var(--border);
            border-left: 4px solid var(--gold); border-radius: 12px;
            padding: 16px 20px; margin-bottom: 20px;
        }
        .level-tag {
            display: inline-block; background: var(--gold); color: #000;
            font-size: 0.72rem; font-weight: 700; padding: 3px 10px; border-radius: 20px;
            text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;
        }
        .mission-box p { font-size: 1rem; line-height: 1.6; }
        .hl { color: var(--gold); font-weight: 700; }

        /* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
        .quiz-q {
            background: var(--bg2); border: 1px solid var(--border); border-radius: 12px;
            padding: 20px 24px; font-size: 1.1rem; font-weight: 600;
            margin-bottom: 14px; line-height: 1.55;
        }
        .quiz-options { display: grid; gap: 10px; }
        .quiz-opt {
            background: var(--bg2); border: 2px solid var(--border); border-radius: 10px;
            padding: 13px 16px; font-size: 0.97rem; cursor: pointer;
            transition: all 0.18s; display: flex; align-items: center; gap: 12px;
        }
        .opt-letter {
            width: 30px; height: 30px; border-radius: 50%; background: var(--bg3);
            border: 1.5px solid var(--border); display: flex; align-items: center;
            justify-content: center; font-weight: 700; font-size: 0.88rem; flex-shrink: 0;
            transition: all 0.18s;
        }
        .quiz-opt:hover:not(.locked) { border-color: var(--gold); background: var(--gold-dim); }
        .quiz-opt:hover:not(.locked) .opt-letter { border-color: var(--gold); color: var(--gold); }
        .quiz-opt.correct { border-color: var(--green); background: rgba(63,185,80,0.08); }
        .quiz-opt.correct .opt-letter { background: var(--green); border-color: var(--green); color: #000; }
        .quiz-opt.wrong   { border-color: var(--red);   background: rgba(248,81,73,0.08); }
        .quiz-opt.wrong .opt-letter   { background: var(--red);   border-color: var(--red);   color: #fff; }
        .quiz-opt.locked  { cursor: default; }

        /* ‚îÄ‚îÄ BUDGET ‚îÄ‚îÄ */
        .budget-wrap {
            background: var(--bg2); border: 1px solid var(--border); border-radius: 12px;
            padding: 14px 20px; margin-bottom: 18px;
        }
        .budget-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .budget-lbl { font-size: 0.78rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .budget-picks { font-size: 0.88rem; color: var(--muted); }
        .budget-picks b { color: var(--text); }
        .budget-track { height: 8px; background: var(--bg3); border-radius: 4px; overflow: hidden; margin-bottom: 8px; }
        .budget-fill  { height: 100%; border-radius: 4px; background: var(--green); transition: width .4s ease, background .4s ease; }
        .budget-fill.tight { background: var(--gold); }
        .budget-fill.over  { background: var(--red); }
        .budget-nums { display: flex; justify-content: space-between; font-size: 0.88rem; }
        .budget-spent { font-weight: 700; font-size: 1.05rem; }
        .budget-left  { color: var(--muted); }

        /* ‚îÄ‚îÄ SORT ‚îÄ‚îÄ */
        .sort-bar { display: flex; align-items: center; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
        .sort-lbl { font-size: 0.75rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .sort-btn {
            background: var(--bg2); border: 1px solid var(--border); color: var(--muted);
            padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: all .15s;
        }
        .sort-btn:hover  { border-color: var(--gold); color: var(--gold); }
        .sort-btn.active { background: var(--gold-dim); border-color: var(--gold); color: var(--gold); font-weight: 600; }

        /* ‚îÄ‚îÄ PLAYER GRID ‚îÄ‚îÄ */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(165px, 1fr));
            gap: 12px; margin-bottom: 18px;
        }
        .player-card {
            background: var(--bg2); border: 2px solid var(--border); border-radius: 14px;
            padding: 13px 11px; cursor: pointer; transition: all 0.2s ease;
            position: relative; overflow: hidden; user-select: none;
        }
        .player-card:hover:not(.disabled) {
            border-color: var(--gold); transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.35);
        }
        .player-card.selected {
            border-color: var(--green); background: rgba(63,185,80,0.07);
            box-shadow: 0 0 0 3px rgba(63,185,80,0.2), 0 8px 20px rgba(0,0,0,0.25);
        }
        .player-card.disabled { opacity: 0.32; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 9px; }
        .p-avatar { font-size: 1.9rem; line-height: 1; }
        .p-name { font-size: 1.3rem; font-weight: 800; color: var(--gold); letter-spacing: 1px; }
        .sel-check {
            display: none; position: absolute; top: 8px; right: 8px;
            width: 20px; height: 20px; background: var(--green); border-radius: 50%;
            align-items: center; justify-content: center; font-size: 0.7rem; color: #000; font-weight: 800;
        }
        .player-card.selected .sel-check { display: flex; }

        /* OBP bar */
        .obp-wrap { margin: 7px 0 9px; }
        .obp-top { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 3px; }
        .obp-lbl { font-size: 0.67rem; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.4px; }
        .obp-val { font-size: 1.05rem; font-weight: 800; }
        .obp-track { height: 6px; background: var(--bg3); border-radius: 3px; overflow: hidden; }
        .obp-fill  { height: 100%; border-radius: 3px; transition: width .5s ease; }

        /* stats */
        .stats-row { display: flex; gap: 7px; margin-bottom: 8px; }
        .stat-pill { flex: 1; background: var(--bg3); border-radius: 6px; padding: 4px 5px; text-align: center; }
        .sp-lbl { font-size: 0.6rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.3px; display: block; }
        .sp-val { font-size: 0.88rem; font-weight: 700; }
        .salary-tag {
            display: flex; align-items: center; justify-content: center;
            background: var(--bg3); border: 1px solid var(--border); border-radius: 8px;
            padding: 6px; margin-top: 2px;
        }
        .sal-amt { font-size: 1rem; font-weight: 800; }
        .sal-unit { font-size: 0.7rem; color: var(--muted); margin-left: 2px; }

        /* ‚îÄ‚îÄ HINTS ‚îÄ‚îÄ */
        .hint-area { margin: 10px 0; }
        .hint-box {
            display: none; margin-top: 8px;
            background: rgba(245,166,35,0.08); border: 1px solid rgba(245,166,35,0.28);
            border-radius: 10px; padding: 11px 15px; font-size: 0.92rem; color: var(--gold); line-height: 1.5;
        }
        .hint-box.show { display: block; }
        .hint-step { font-size: 0.7rem; color: rgba(245,166,35,0.55); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 4px; }

        /* ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ */
        .feedback-box {
            display: none; border-radius: 12px; padding: 15px 18px; margin: 14px 0;
        }
        .feedback-box.show { display: block; }
        .feedback-box.success { background: rgba(63,185,80,0.1); border: 1px solid rgba(63,185,80,0.38); color: var(--green); }
        .feedback-box.error   { background: rgba(248,81,73,0.1); border: 1px solid rgba(248,81,73,0.38); color: var(--red); }
        .fb-icon  { font-size: 1.7rem; margin-bottom: 5px; }
        .fb-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 3px; }
        .fb-body  { font-size: 0.88rem; line-height: 1.5; opacity: 0.88; }

        /* ‚îÄ‚îÄ EFFICIENCY SCORE ‚îÄ‚îÄ */
        .eff-box {
            display: none; background: var(--bg2); border: 1px solid var(--border);
            border-radius: 12px; padding: 16px 20px; margin: 12px 0; text-align: center;
        }
        .eff-box.show { display: block; }
        .eff-lbl { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
        .eff-score { font-size: 2.3rem; font-weight: 800; color: var(--gold); }
        .eff-sub   { font-size: 0.85rem; color: var(--muted); margin-top: 4px; }

        /* ‚îÄ‚îÄ BREAKDOWN TABLE ‚îÄ‚îÄ */
        .breakdown {
            display: none; margin: 12px 0;
            background: var(--bg2); border: 1px solid var(--border); border-radius: 12px; overflow: hidden;
        }
        .breakdown.show { display: block; }
        .bd-title { padding: 10px 16px; background: var(--bg3); font-size: 0.78rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--muted); }
        .bd-head, .bd-row {
            display: grid; grid-template-columns: 36px 1fr 62px 62px 90px;
            gap: 8px; padding: 9px 16px; align-items: center; font-size: 0.88rem;
        }
        .bd-head { background: var(--bg3); color: var(--muted); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.4px; }
        .bd-row { border-top: 1px solid var(--border); transition: background .15s; }
        .bd-row:hover { background: var(--bg3); }
        .bd-row.your-pick { background: rgba(63,185,80,0.05); }
        .bd-row.optimal   { border-left: 3px solid var(--gold); }
        .val-bar { display: flex; align-items: center; gap: 6px; }
        .val-num { font-size: 0.78rem; font-weight: 700; min-width: 28px; }
        .val-track { flex: 1; height: 5px; background: var(--bg3); border-radius: 3px; overflow: hidden; }
        .val-fill  { height: 100%; border-radius: 3px; background: var(--gold); }

        /* ‚îÄ‚îÄ ACHIEVEMENTS ‚îÄ‚îÄ */
        .ach-strip { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
        .ach {
            display: flex; align-items: center; gap: 6px;
            background: var(--bg2); border: 1px solid var(--border); border-radius: 20px;
            padding: 5px 12px; font-size: 0.8rem; color: var(--muted);
            opacity: 0.38; transition: all .4s ease;
        }
        .ach.earned {
            opacity: 1; border-color: var(--gold); color: var(--gold);
            background: var(--gold-dim); animation: pop .45s cubic-bezier(.175,.885,.32,1.275);
        }
        @keyframes pop { 0%{transform:scale(0.7);opacity:0} 100%{transform:scale(1);opacity:1} }

        /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
        .buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        button { padding: 11px 24px; font-size: 0.93rem; font-weight: 700; border: none; border-radius: 8px; cursor: pointer; transition: all .18s ease; }
        .btn-primary { background: linear-gradient(135deg, var(--green), var(--green-dark)); color: #000; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(63,185,80,0.32); }
        .btn-primary:disabled { background: var(--bg3); color: var(--muted); cursor: not-allowed; border: 1px solid var(--border); }
        .btn-secondary { background: transparent; color: var(--text); border: 1.5px solid var(--border); }
        .btn-secondary:hover { border-color: var(--text); }
        .btn-hint { background: var(--gold-dim); color: var(--gold); border: 1.5px solid rgba(245,166,35,0.35); }
        .btn-hint:hover { background: rgba(245,166,35,0.22); }

        /* ‚îÄ‚îÄ FINAL SCREEN ‚îÄ‚îÄ */
        .final-wrap { text-align: center; padding: 24px 0; }
        .trophy { font-size: 5rem; display: block; margin-bottom: 16px; animation: tbounce .7s ease infinite alternate; }
        @keyframes tbounce { from{transform:translateY(0) rotate(-4deg)} to{transform:translateY(-12px) rotate(4deg)} }
        .final-title {
            font-size: clamp(1.8rem, 5vw, 2.6rem); font-weight: 800;
            background: linear-gradient(130deg, var(--gold), #fff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            margin-bottom: 6px;
        }
        .final-sub { color: var(--muted); font-size: 0.97rem; margin-bottom: 28px; }
        .code-box {
            background: linear-gradient(135deg, var(--green-dark), #1a7f37);
            border: 1px solid var(--green); border-radius: 16px;
            padding: 22px; margin: 0 auto 22px; max-width: 420px;
        }
        .code-lbl { font-size: 0.8rem; color: rgba(255,255,255,0.65); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .code-val {
            font-family: 'Courier New', monospace; font-size: 1.55rem; font-weight: 700;
            color: #fff; background: rgba(0,0,0,0.22); padding: 10px 20px;
            border-radius: 10px; letter-spacing: 3px; display: inline-block; margin-bottom: 12px;
        }
        .copy-btn {
            background: rgba(255,255,255,0.14); color: #fff; border: 1px solid rgba(255,255,255,0.28);
            padding: 6px 16px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; transition: background .2s;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.24); }
        .summary-box {
            background: var(--bg2); border: 1px solid var(--border); border-radius: 14px;
            padding: 20px 24px; margin: 0 auto 22px; max-width: 520px; text-align: left;
        }
        .summary-box h3 { color: var(--gold); font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 14px; text-align: center; }
        .sum-item { display: flex; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 0.92rem; line-height: 1.5; }
        .sum-item:last-child { border-bottom: none; }
        .sum-check { color: var(--green); font-weight: 700; flex-shrink: 0; }
        .final-ach { margin: 0 auto 20px; max-width: 460px; }
        .final-ach h3 { font-size: 0.8rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
        .final-ach-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .final-ach-badge {
            display: flex; align-items: center; gap: 6px;
            background: var(--gold-dim); border: 1px solid rgba(245,166,35,0.35);
            border-radius: 20px; padding: 5px 14px; font-size: 0.82rem; color: var(--gold);
        }

        /* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
        #confetti-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 9999; }

        /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
        @media (max-width: 560px) {
            .players-grid { grid-template-columns: repeat(2, 1fr); }
            .bd-head, .bd-row { grid-template-columns: 28px 1fr 52px 52px 70px; font-size: 0.77rem; padding: 8px 10px; }
            .p-node { max-width: 60px; }
            .p-label { display: none; }
        }
        @media (max-width: 360px) {
            .players-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
<canvas id="confetti-canvas"></canvas>
<div class="container">

    <header>
        <span class="header-ball">‚öæ</span>
        <h1>Moneyball Draft Challenge</h1>
        <p class="header-sub">Learn to build a winning team on a budget</p>
    </header>

    <div class="progress-wrap">
        <div class="progress-track" id="progress-track"></div>
    </div>

    <!-- SCREEN 1: Quiz -->
    <div class="screen" id="screen-1">
        <div class="mission-box">
            <div class="level-tag">Level 1 ¬∑ Learn the Secret</div>
            <p>Before you draft, you need to know the <span class="hl">secret stat</span> that smart managers use to find hidden value!</p>
        </div>
        <div class="quiz-q">In baseball, what does <strong>OBP</strong> (On-Base Percentage) tell you?</div>
        <div class="quiz-options" id="quiz-options">
            <div class="quiz-opt" data-ans="A"><div class="opt-letter">A</div>How fast a player can run</div>
            <div class="quiz-opt" data-ans="B"><div class="opt-letter">B</div>How often a player gets on base (hits, walks, and more)</div>
            <div class="quiz-opt" data-ans="C"><div class="opt-letter">C</div>How many home runs a player hits</div>
            <div class="quiz-opt" data-ans="D"><div class="opt-letter">D</div>How popular a player is with fans</div>
        </div>
        <div class="feedback-box" id="feedback-1"></div>
        <div class="buttons">
            <button class="btn-primary" id="next-1" style="display:none" onclick="goToLevel(2)">Start Drafting ‚Üí</button>
        </div>
    </div>

    <!-- SCREEN 2: Draft -->
    <div class="screen" id="screen-2">
        <div class="mission-box">
            <div class="level-tag">Level 2 ¬∑ Your First Draft</div>
            <p>Pick <span class="hl">2 players</span> for your team with only <span class="hl">$25M</span>. Find the best OBP for the lowest price!</p>
        </div>
        <div class="budget-wrap" id="budget-2"></div>
        <div class="sort-bar">
            <span class="sort-lbl">Sort by:</span>
            <button class="sort-btn active" id="sort-2-obp"    onclick="sortPlayers(2,'obp')">OBP ‚Üì</button>
            <button class="sort-btn"        id="sort-2-salary" onclick="sortPlayers(2,'salary')">Salary ‚Üë</button>
            <button class="sort-btn"        id="sort-2-stars"  onclick="sortPlayers(2,'stars')">Popularity ‚Üì</button>
        </div>
        <div class="players-grid" id="grid-2"></div>
        <div class="hint-area">
            <button class="btn-hint" id="hint-btn-2" onclick="showNextHint(2)">üí° Need a Hint?</button>
            <div class="hint-box" id="hint-2"></div>
        </div>
        <div class="feedback-box" id="feedback-2"></div>
        <div class="eff-box" id="eff-2"></div>
        <div class="breakdown" id="breakdown-2"></div>
        <div class="buttons" id="btns-2">
            <button class="btn-primary" id="check-2" disabled onclick="checkLevel(2)">Check My Picks ‚úì</button>
        </div>
    </div>

    <!-- SCREEN 3: Draft -->
    <div class="screen" id="screen-3">
        <div class="mission-box">
            <div class="level-tag">Level 3 ¬∑ The Real Challenge</div>
            <p>Budget cut! Pick <span class="hl">2 players</span> with only <span class="hl">$15M</span>. Stars don't matter ‚Äî data does!</p>
        </div>
        <div class="budget-wrap" id="budget-3"></div>
        <div class="sort-bar">
            <span class="sort-lbl">Sort by:</span>
            <button class="sort-btn active" id="sort-3-obp"    onclick="sortPlayers(3,'obp')">OBP ‚Üì</button>
            <button class="sort-btn"        id="sort-3-salary" onclick="sortPlayers(3,'salary')">Salary ‚Üë</button>
            <button class="sort-btn"        id="sort-3-stars"  onclick="sortPlayers(3,'stars')">Popularity ‚Üì</button>
        </div>
        <div class="players-grid" id="grid-3"></div>
        <div class="hint-area">
            <button class="btn-hint" id="hint-btn-3" onclick="showNextHint(3)">üí° Need a Hint?</button>
            <div class="hint-box" id="hint-3"></div>
        </div>
        <div class="feedback-box" id="feedback-3"></div>
        <div class="eff-box" id="eff-3"></div>
        <div class="breakdown" id="breakdown-3"></div>
        <div class="buttons" id="btns-3">
            <button class="btn-primary" id="check-3" disabled onclick="checkLevel(3)">Check My Picks ‚úì</button>
        </div>
    </div>

    <!-- SCREEN 4: OPS Era -->
    <div class="screen" id="screen-4">
        <div class="mission-box">
            <div class="level-tag">Level 4 ¬∑ The OPS Era</div>
            <p>New stat unlocked! <span class="hl">OPS = OBP + SLG</span>. Pick <span class="hl">2 players</span> with <span class="hl">$22M</span>. A player who gets on base AND hits for power is the real gem!</p>
        </div>
        <div class="budget-wrap" id="budget-4"></div>
        <div class="sort-bar">
            <span class="sort-lbl">Sort by:</span>
            <button class="sort-btn"        id="sort-4-obp"    onclick="sortPlayers(4,'obp')">OBP ‚Üì</button>
            <button class="sort-btn active" id="sort-4-ops"    onclick="sortPlayers(4,'ops')">OPS ‚Üì</button>
            <button class="sort-btn"        id="sort-4-salary" onclick="sortPlayers(4,'salary')">Salary ‚Üë</button>
            <button class="sort-btn"        id="sort-4-stars"  onclick="sortPlayers(4,'stars')">Popularity ‚Üì</button>
        </div>
        <div class="players-grid" id="grid-4"></div>
        <div class="hint-area">
            <button class="btn-hint" id="hint-btn-4" onclick="showNextHint(4)">üí° Need a Hint?</button>
            <div class="hint-box" id="hint-4"></div>
        </div>
        <div class="feedback-box" id="feedback-4"></div>
        <div class="eff-box" id="eff-4"></div>
        <div class="breakdown" id="breakdown-4"></div>
        <div class="buttons" id="btns-4">
            <button class="btn-primary" id="check-4" disabled onclick="checkLevel(4)">Check My Picks ‚úì</button>
        </div>
    </div>

    <!-- SCREEN 5: WAR Room -->
    <div class="screen" id="screen-5">
        <div class="mission-box">
            <div class="level-tag">Level 5 ¬∑ The WAR Room</div>
            <p>Advanced mode! <span class="hl">WAR</span> (Wins Above Replacement) measures <em>everything</em> ‚Äî hitting, fielding, baserunning. Pick <span class="hl">3 players</span> with <span class="hl">$24M</span> to maximize your team's total WAR!</p>
        </div>
        <div class="budget-wrap" id="budget-5"></div>
        <div class="sort-bar">
            <span class="sort-lbl">Sort by:</span>
            <button class="sort-btn"        id="sort-5-obp"    onclick="sortPlayers(5,'obp')">OBP ‚Üì</button>
            <button class="sort-btn active" id="sort-5-war"    onclick="sortPlayers(5,'war')">WAR ‚Üì</button>
            <button class="sort-btn"        id="sort-5-salary" onclick="sortPlayers(5,'salary')">Salary ‚Üë</button>
        </div>
        <div class="players-grid" id="grid-5"></div>
        <div class="hint-area">
            <button class="btn-hint" id="hint-btn-5" onclick="showNextHint(5)">üí° Need a Hint?</button>
            <div class="hint-box" id="hint-5"></div>
        </div>
        <div class="feedback-box" id="feedback-5"></div>
        <div class="eff-box" id="eff-5"></div>
        <div class="breakdown" id="breakdown-5"></div>
        <div class="buttons" id="btns-5">
            <button class="btn-primary" id="check-5" disabled onclick="checkLevel(5)">Check My Picks ‚úì</button>
        </div>
    </div>

    <!-- SCREEN 6: Championship GM -->
    <div class="screen" id="screen-6">
        <div class="mission-box">
            <div class="level-tag">Level 6 ¬∑ Championship GM</div>
            <p>The final challenge! Pick <span class="hl">4 players</span> with <span class="hl">$30M</span>. Balance <span class="hl">OPS</span> AND <span class="hl">WAR</span> ‚Äî no single stat is enough to build a champion!</p>
        </div>
        <div class="budget-wrap" id="budget-6"></div>
        <div class="sort-bar">
            <span class="sort-lbl">Sort by:</span>
            <button class="sort-btn active" id="sort-6-ops"    onclick="sortPlayers(6,'ops')">OPS ‚Üì</button>
            <button class="sort-btn"        id="sort-6-war"    onclick="sortPlayers(6,'war')">WAR ‚Üì</button>
            <button class="sort-btn"        id="sort-6-salary" onclick="sortPlayers(6,'salary')">Salary ‚Üë</button>
        </div>
        <div class="players-grid" id="grid-6"></div>
        <div class="hint-area">
            <button class="btn-hint" id="hint-btn-6" onclick="showNextHint(6)">üí° Need a Hint?</button>
            <div class="hint-box" id="hint-6"></div>
        </div>
        <div class="feedback-box" id="feedback-6"></div>
        <div class="eff-box" id="eff-6"></div>
        <div class="breakdown" id="breakdown-6"></div>
        <div class="buttons" id="btns-6">
            <button class="btn-primary" id="check-6" disabled onclick="checkLevel(6)">Check My Picks ‚úì</button>
        </div>
    </div>

    <!-- SCREEN: Final -->
    <div class="screen" id="screen-final">
        <div class="final-wrap">
            <span class="trophy">üèÜ</span>
            <h2 class="final-title">You're a Moneyball Master!</h2>
            <p class="final-sub">You completed all 6 levels and mastered data analytics like a real GM!</p>
            <div class="code-box">
                <div class="code-lbl">Your Completion Code</div>
                <div class="code-val">101-M3-L1-MONEYBALL</div><br>
                <button class="copy-btn" onclick="copyCode()">üìã Copy Code</button>
            </div>
            <div class="final-ach">
                <h3>üèÖ Achievements Earned</h3>
                <div class="final-ach-grid" id="final-ach-grid"></div>
            </div>
            <div class="summary-box">
                <h3>üìñ What You Learned</h3>
                <div class="sum-item"><span class="sum-check">‚úì</span><span><strong>OBP</strong> tells you how often a player gets on base ‚Äî the real key to scoring runs</span></div>
                <div class="sum-item"><span class="sum-check">‚úì</span><span>Popular high-star players aren't always the best value ‚Äî data beats hype</span></div>
                <div class="sum-item"><span class="sum-check">‚úì</span><span><strong>OPS</strong> (OBP + Slugging) gives the full offensive picture ‚Äî getting on base AND power matter</span></div>
                <div class="sum-item"><span class="sum-check">‚úì</span><span><strong>WAR</strong> (Wins Above Replacement) captures everything ‚Äî hitting, fielding, baserunning in one number</span></div>
                <div class="sum-item"><span class="sum-check">‚úì</span><span>Real GMs balance <strong>multiple stats</strong> and budgets to build championship rosters!</span></div>
            </div>
            <div class="buttons">
                <button class="btn-secondary" onclick="restartGame()">‚Ü∫ Play Again</button>
            </div>
        </div>
    </div>

</div><!-- /container -->

<script>
// ‚îÄ‚îÄ‚îÄ GAME DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const LEVELS = {
    2: {
        budget: 25, picks: 2,
        optimal: ['B', 'C'],
        statMode: 'obp',
        hints: [
            { step: 'Hint 1 of 2', text: 'Try sorting by OBP ‚Äî which players get on base most often for the lowest price?' },
            { step: 'Hint 2 of 2', text: 'Player C has the highest OBP (0.400) and costs only $6M. That\'s the best value deal on the board!' }
        ],
        players: [
            { id:'A', emoji:'‚öæ', obp:0.310, hr:25, salary:13, stars:4 },
            { id:'B', emoji:'üèÉ', obp:0.365, hr:10, salary:7,  stars:2 },
            { id:'C', emoji:'üéØ', obp:0.400, hr:8,  salary:6,  stars:0 },
            { id:'D', emoji:'üí™', obp:0.335, hr:18, salary:9,  stars:3 },
            { id:'E', emoji:'üåü', obp:0.345, hr:15, salary:11, stars:2 }
        ]
    },
    3: {
        budget: 15, picks: 2,
        optimal: ['G', 'H'],
        statMode: 'obp',
        hints: [
            { step: 'Hint 1 of 2', text: 'With only $15M, you can\'t afford the big stars. Try sorting by Salary first to see what\'s affordable.' },
            { step: 'Hint 2 of 2', text: 'Players G and H together cost only $12M and have great OBP. That\'s the Moneyball move!' }
        ],
        players: [
            { id:'F', emoji:'‚≠ê', obp:0.290, hr:30, salary:14, stars:5 },
            { id:'G', emoji:'üéØ', obp:0.355, hr:5,  salary:5,  stars:1 },
            { id:'H', emoji:'üèÉ', obp:0.380, hr:6,  salary:7,  stars:0 },
            { id:'I', emoji:'üí™', obp:0.320, hr:20, salary:10, stars:3 },
            { id:'J', emoji:'üåü', obp:0.340, hr:12, salary:8,  stars:2 }
        ]
    },
    4: {
        budget: 22, picks: 2,
        optimal: ['L', 'N'],
        statMode: 'ops',
        hints: [
            { step: 'Hint 1 of 2', text: 'Sort by OPS ‚Äî it combines OBP and Slugging. A player can look great on OBP alone but have a weak OPS if they rarely hit for power!' },
            { step: 'Hint 2 of 2', text: 'Player L has 0.850 OPS at $10M. Player N has 0.805 OPS at just $8M. Together for $18M they give you the best combined offense!' }
        ],
        players: [
            { id:'K', emoji:'üß©', obp:0.410, slg:0.290, ops:0.700, hr:7,  salary:13, stars:3 },
            { id:'L', emoji:'üíé', obp:0.345, slg:0.505, ops:0.850, hr:28, salary:10, stars:2 },
            { id:'M', emoji:'‚≠ê', obp:0.295, slg:0.560, ops:0.855, hr:40, salary:15, stars:5 },
            { id:'N', emoji:'üéØ', obp:0.360, slg:0.445, ops:0.805, hr:21, salary:8,  stars:1 },
            { id:'O', emoji:'üî•', obp:0.330, slg:0.430, ops:0.760, hr:17, salary:7,  stars:2 },
            { id:'P', emoji:'üåü', obp:0.290, slg:0.360, ops:0.650, hr:12, salary:5,  stars:4 }
        ]
    },
    5: {
        budget: 24, picks: 3,
        optimal: ['T', 'R', 'V'],
        statMode: 'war',
        hints: [
            { step: 'Hint 1 of 2', text: 'Sort by WAR ‚Äî it measures everything a player contributes, not just home runs. A 5-star player with low WAR is fooling you!' },
            { step: 'Hint 2 of 2', text: 'Player T has the highest WAR (5.0) at $10M. Player R has 4.2 WAR for only $8M. Add Player V (2.8 WAR, $6M) and you\'ve spent exactly $24M for 12.0 total WAR!' }
        ],
        players: [
            { id:'Q', emoji:'üåü', obp:0.350, war:1.5, hr:30, salary:12, stars:5 },
            { id:'R', emoji:'üéØ', obp:0.340, war:4.2, hr:18, salary:8,  stars:0 },
            { id:'S', emoji:'‚≠ê', obp:0.380, war:3.1, hr:12, salary:11, stars:4 },
            { id:'T', emoji:'üí™', obp:0.310, war:5.0, hr:35, salary:10, stars:1 },
            { id:'U', emoji:'üèÉ', obp:0.360, war:3.6, hr:22, salary:7,  stars:2 },
            { id:'V', emoji:'üî•', obp:0.325, war:2.8, hr:19, salary:6,  stars:1 },
            { id:'W', emoji:'üß†', obp:0.290, war:1.2, hr:14, salary:5,  stars:3 }
        ]
    },
    6: {
        budget: 30, picks: 4,
        optimal: ['Y', 'Z', 'BB', 'CC'],
        statMode: 'composite',
        hints: [
            { step: 'Hint 1 of 2', text: 'Sort by both OPS and WAR ‚Äî you need balance. Player X looks incredible but costs $12M alone, leaving too little for the other 3 spots!' },
            { step: 'Hint 2 of 2', text: 'Players Y, Z, BB, and CC together cost exactly $30M. Check their OPS AND WAR ‚Äî they\'re the most well-rounded roster you can build!' }
        ],
        players: [
            { id:'X',  emoji:'üèÜ', obp:0.385, ops:0.840, war:4.8, hr:28, salary:12, stars:5 },
            { id:'Y',  emoji:'üéØ', obp:0.355, ops:0.830, war:4.2, hr:24, salary:9,  stars:1 },
            { id:'Z',  emoji:'üíé', obp:0.370, ops:0.810, war:3.8, hr:20, salary:8,  stars:2 },
            { id:'AA', emoji:'üåü', obp:0.290, ops:0.880, war:2.5, hr:45, salary:11, stars:4 },
            { id:'BB', emoji:'üß†', obp:0.345, ops:0.760, war:3.5, hr:18, salary:7,  stars:0 },
            { id:'CC', emoji:'‚ö°', obp:0.335, ops:0.765, war:2.9, hr:16, salary:6,  stars:1 },
            { id:'DD', emoji:'üí™', obp:0.310, ops:0.800, war:1.8, hr:32, salary:8,  stars:4 },
            { id:'EE', emoji:'üî•', obp:0.325, ops:0.710, war:2.2, hr:14, salary:5,  stars:2 }
        ]
    }
};

const PROGRESS_LABELS = ['Learn the Secret', 'First Draft', 'Real Challenge', 'The OPS Era', 'The WAR Room', 'Championship GM'];

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const state = {
    currentLevel: 1,
    sortMode: { 2: 'obp', 3: 'obp', 4: 'ops', 5: 'war', 6: 'ops' },
    levels: {
        2: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        3: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        4: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        5: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        6: { selected: [], hintsShown: 0, attempts: 0, completed: false }
    },
    achievements: { firstTry: true, noHints: true }
};

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function init() {
    renderProgress();
    renderPlayers(2);
    renderPlayers(3);
    renderPlayers(4);
    renderPlayers(5);
    renderPlayers(6);
    renderBudget(2);
    renderBudget(3);
    renderBudget(4);
    renderBudget(5);
    renderBudget(6);

    // Quiz click handlers
    document.querySelectorAll('.quiz-opt').forEach(opt => {
        opt.addEventListener('click', () => {
            if (opt.classList.contains('locked')) return;
            checkQuiz(opt.dataset.ans);
        });
    });

    // Show first screen
    const s = document.getElementById('screen-1');
    s.classList.add('active');
    requestAnimationFrame(() => requestAnimationFrame(() => s.classList.add('visible')));
}

// ‚îÄ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderProgress() {
    const track = document.getElementById('progress-track');
    const lvl = state.currentLevel;
    let html = '';
    for (let i = 1; i <= 6; i++) {
        const done   = (i < lvl) || (lvl > 6);
        const active = (i === lvl) && (lvl <= 6);
        const cc = done ? 'done' : active ? 'active' : '';
        html += `<div class="p-node">
            <div class="p-circle ${cc}">${done ? '‚úì' : i}</div>
            <div class="p-label ${cc}">${PROGRESS_LABELS[i-1]}</div>
        </div>`;
        if (i < 6) {
            html += `<div class="p-line ${done ? 'done' : ''}"></div>`;
        }
    }
    track.innerHTML = html;
}

// ‚îÄ‚îÄ‚îÄ COLOR HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function obpColor(obp) {
    // 0.280 ‚Üí red, 0.380+ ‚Üí green
    const t = Math.max(0, Math.min(1, (obp - 0.280) / 0.120));
    const r = Math.round(248 - t * (248 - 63));
    const g = Math.round(81  + t * (185 - 81));
    const b = Math.round(73  - t * (73 - 50));
    return `rgb(${r},${g},${b})`;
}
function obpWidth(obp) {
    return Math.round(Math.max(5, Math.min(100, (obp - 0.240) / 0.200 * 100)));
}
function opsColor(ops) {
    // 0.600 ‚Üí red, 0.900+ ‚Üí green
    const t = Math.max(0, Math.min(1, (ops - 0.600) / 0.300));
    const r = Math.round(248 - t * (248 - 63));
    const g = Math.round(81  + t * (185 - 81));
    const b = Math.round(73  - t * (73 - 50));
    return `rgb(${r},${g},${b})`;
}
function opsWidth(ops) {
    return Math.round(Math.max(5, Math.min(100, (ops - 0.550) / 0.400 * 100)));
}
function warColor(war) {
    // 0 ‚Üí red, 5+ ‚Üí green
    const t = Math.max(0, Math.min(1, war / 5));
    const r = Math.round(248 - t * (248 - 63));
    const g = Math.round(81  + t * (185 - 81));
    const b = Math.round(73  - t * (73 - 50));
    return `rgb(${r},${g},${b})`;
}

// ‚îÄ‚îÄ‚îÄ RENDER PLAYERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function sortedPlayers(level) {
    const players = [...LEVELS[level].players];
    const mode = state.sortMode[level];
    if (mode === 'obp')    return players.sort((a,b) => b.obp - a.obp);
    if (mode === 'salary') return players.sort((a,b) => a.salary - b.salary);
    if (mode === 'stars')  return players.sort((a,b) => b.stars - a.stars);
    if (mode === 'ops')    return players.sort((a,b) => b.ops - a.ops);
    if (mode === 'war')    return players.sort((a,b) => b.war - a.war);
    return players;
}

function renderCardStats(p, statMode) {
    const stars = p.stars > 0 ? '‚≠ê'.repeat(p.stars) : '‚Äî';
    if (statMode === 'ops') {
        return `
            <div class="obp-wrap">
                <div class="obp-top">
                    <span class="obp-lbl">OPS</span>
                    <span class="obp-val" style="color:${opsColor(p.ops)}">${p.ops.toFixed(3)}</span>
                </div>
                <div class="obp-track">
                    <div class="obp-fill" style="width:${opsWidth(p.ops)}%;background:${opsColor(p.ops)}"></div>
                </div>
            </div>
            <div class="stats-row">
                <div class="stat-pill"><span class="sp-lbl">OBP</span><span class="sp-val" style="color:${obpColor(p.obp)}">${p.obp.toFixed(3)}</span></div>
                <div class="stat-pill"><span class="sp-lbl">SLG</span><span class="sp-val">${p.slg.toFixed(3)}</span></div>
                <div class="stat-pill"><span class="sp-lbl">Pop</span><span class="sp-val" style="font-size:0.72rem">${stars}</span></div>
            </div>`;
    }
    if (statMode === 'war') {
        return `
            <div class="obp-wrap">
                <div class="obp-top">
                    <span class="obp-lbl">OBP</span>
                    <span class="obp-val" style="color:${obpColor(p.obp)}">${p.obp.toFixed(3)}</span>
                </div>
                <div class="obp-track">
                    <div class="obp-fill" style="width:${obpWidth(p.obp)}%;background:${obpColor(p.obp)}"></div>
                </div>
            </div>
            <div class="stats-row">
                <div class="stat-pill"><span class="sp-lbl">WAR</span><span class="sp-val" style="color:${warColor(p.war)}">${p.war.toFixed(1)}</span></div>
                <div class="stat-pill"><span class="sp-lbl">HR</span><span class="sp-val">${p.hr}</span></div>
                <div class="stat-pill"><span class="sp-lbl">Pop</span><span class="sp-val" style="font-size:0.72rem">${stars}</span></div>
            </div>`;
    }
    if (statMode === 'composite') {
        return `
            <div class="obp-wrap">
                <div class="obp-top">
                    <span class="obp-lbl">OPS</span>
                    <span class="obp-val" style="color:${opsColor(p.ops)}">${p.ops.toFixed(3)}</span>
                </div>
                <div class="obp-track">
                    <div class="obp-fill" style="width:${opsWidth(p.ops)}%;background:${opsColor(p.ops)}"></div>
                </div>
            </div>
            <div class="stats-row">
                <div class="stat-pill"><span class="sp-lbl">WAR</span><span class="sp-val" style="color:${warColor(p.war)}">${p.war.toFixed(1)}</span></div>
                <div class="stat-pill"><span class="sp-lbl">OBP</span><span class="sp-val" style="color:${obpColor(p.obp)}">${p.obp.toFixed(3)}</span></div>
            </div>`;
    }
    // Default: 'obp' mode (levels 2-3)
    return `
        <div class="obp-wrap">
            <div class="obp-top">
                <span class="obp-lbl">OBP</span>
                <span class="obp-val" style="color:${obpColor(p.obp)}">${p.obp.toFixed(3)}</span>
            </div>
            <div class="obp-track">
                <div class="obp-fill" style="width:${obpWidth(p.obp)}%;background:${obpColor(p.obp)}"></div>
            </div>
        </div>
        <div class="stats-row">
            <div class="stat-pill"><span class="sp-lbl">HR</span><span class="sp-val">${p.hr}</span></div>
            <div class="stat-pill"><span class="sp-lbl">Pop</span><span class="sp-val" style="font-size:0.72rem">${stars}</span></div>
        </div>`;
}

function renderPlayers(level) {
    const grid = document.getElementById(`grid-${level}`);
    const ls = state.levels[level];
    const lv = LEVELS[level];
    const spent = getSpent(level);
    const statMode = lv.statMode || 'obp';

    grid.innerHTML = sortedPlayers(level).map(p => {
        const isSel = ls.selected.includes(p.id);
        const canAfford = spent + p.salary <= lv.budget;
        const isDis = !isSel && (ls.selected.length >= lv.picks || !canAfford);

        return `<div class="player-card${isSel ? ' selected' : ''}${isDis ? ' disabled' : ''}"
                     id="card-${level}-${p.id}" onclick="pickPlayer(${level},'${p.id}')">
            <div class="sel-check">‚úì</div>
            <div class="card-top">
                <span class="p-avatar">${p.emoji}</span>
                <span class="p-name">${p.id}</span>
            </div>
            ${renderCardStats(p, statMode)}
            <div class="salary-tag">
                <span class="sal-amt">$${p.salary}M</span>
                <span class="sal-unit">salary</span>
            </div>
        </div>`;
    }).join('');
}

// ‚îÄ‚îÄ‚îÄ SORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SORT_KEYS = {
    2: ['obp','salary','stars'],
    3: ['obp','salary','stars'],
    4: ['obp','ops','salary','stars'],
    5: ['obp','war','salary'],
    6: ['ops','war','salary']
};

function sortPlayers(level, mode) {
    state.sortMode[level] = mode;
    const keys = SORT_KEYS[level] || ['obp','salary','stars'];
    keys.forEach(m => {
        const btn = document.getElementById(`sort-${level}-${m}`);
        if (btn) btn.classList.toggle('active', m === mode);
    });
    renderPlayers(level);
}

// ‚îÄ‚îÄ‚îÄ BUDGET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getSpent(level) {
    const players = LEVELS[level].players;
    return state.levels[level].selected.reduce((sum, id) => {
        return sum + players.find(p => p.id === id).salary;
    }, 0);
}

function renderBudget(level) {
    const budget = LEVELS[level].budget;
    const picks  = LEVELS[level].picks;
    const ls     = state.levels[level];
    const spent  = getSpent(level);
    const pct    = Math.min(100, (spent / budget) * 100);
    const fillCls= pct > 90 ? 'over' : pct > 75 ? 'tight' : '';

    document.getElementById(`budget-${level}`).innerHTML = `
        <div class="budget-top">
            <span class="budget-lbl">Budget: $${budget}M</span>
            <span class="budget-picks">Picks: <b>${ls.selected.length} / ${picks}</b></span>
        </div>
        <div class="budget-track">
            <div class="budget-fill ${fillCls}" style="width:${pct}%"></div>
        </div>
        <div class="budget-nums">
            <span class="budget-spent">$${spent}M spent</span>
            <span class="budget-left">$${budget - spent}M remaining</span>
        </div>`;
}

// ‚îÄ‚îÄ‚îÄ PICK PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function pickPlayer(level, id) {
    const ls = state.levels[level];
    const lv = LEVELS[level];
    const player = lv.players.find(p => p.id === id);
    const card = document.getElementById(`card-${level}-${id}`);
    if (card.classList.contains('disabled')) return;

    if (ls.selected.includes(id)) {
        ls.selected = ls.selected.filter(x => x !== id);
    } else {
        const spent = getSpent(level);
        if (ls.selected.length < lv.picks && spent + player.salary <= lv.budget) {
            ls.selected.push(id);
        }
    }

    renderPlayers(level);
    renderBudget(level);
    document.getElementById(`check-${level}`).disabled = ls.selected.length !== lv.picks;
}

// ‚îÄ‚îÄ‚îÄ HINTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showNextHint(level) {
    const ls  = state.levels[level];
    const hints = LEVELS[level].hints;
    if (ls.hintsShown >= hints.length) return;

    state.achievements.noHints = false;

    const hint = hints[ls.hintsShown];
    ls.hintsShown++;

    const box = document.getElementById(`hint-${level}`);
    box.innerHTML = `<div class="hint-step">${hint.step}</div>${hint.text}`;
    box.classList.add('show');

    const btn = document.getElementById(`hint-btn-${level}`);
    if (ls.hintsShown >= hints.length) {
        btn.style.display = 'none';
    } else {
        btn.textContent = 'üí° More Hint';
    }
}

// ‚îÄ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkQuiz(answer) {
    const opts = document.querySelectorAll('.quiz-opt');
    opts.forEach(o => {
        o.classList.add('locked');
        if (o.dataset.ans === 'B') o.classList.add('correct');
        else if (o.dataset.ans === answer && answer !== 'B') o.classList.add('wrong');
    });

    const fb = document.getElementById('feedback-1');
    if (answer === 'B') {
        fb.className = 'feedback-box show success';
        fb.innerHTML = `<div class="fb-icon">üéâ</div><div class="fb-title">Correct!</div>
            <div class="fb-body">OBP tells you how often a player reaches base ‚Äî hits, walks, and more. A high OBP means more runs!</div>`;
    } else {
        fb.className = 'feedback-box show error';
        fb.innerHTML = `<div class="fb-icon">üí°</div><div class="fb-title">Not quite!</div>
            <div class="fb-body">The answer is <strong>B</strong>. OBP shows how often a player gets on base ‚Äî that's the secret stat smart managers track!</div>`;
    }
    document.getElementById('next-1').style.display = 'inline-block';
}

// ‚îÄ‚îÄ‚îÄ CHECK DRAFT LEVEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function levelEffScore(level, sel, spent) {
    const lv = LEVELS[level];
    const players = lv.players;
    if (lv.statMode === 'ops') {
        const totalOps = sel.reduce((s, id) => s + players.find(p => p.id === id).ops, 0);
        return { score: ((totalOps / spent) * 1000).toFixed(1), label: 'OPS Efficiency Score', sub: 'Total OPS √∑ $ Spent √ó 1000' };
    }
    if (lv.statMode === 'war') {
        const totalWar = sel.reduce((s, id) => s + players.find(p => p.id === id).war, 0);
        return { score: totalWar.toFixed(1), label: 'Team Total WAR', sub: 'Sum of all players\' Wins Above Replacement' };
    }
    if (lv.statMode === 'composite') {
        const totalOps = sel.reduce((s, id) => s + players.find(p => p.id === id).ops, 0);
        const totalWar = sel.reduce((s, id) => s + players.find(p => p.id === id).war, 0);
        return { score: (((totalOps + totalWar / 10) / spent) * 100).toFixed(1), label: 'Composite GM Score', sub: '(OPS + WAR√∑10) √∑ $ Spent √ó 100 ¬∑ Higher = Champion' };
    }
    // Default: OBP
    const totalObp = sel.reduce((s, id) => s + players.find(p => p.id === id).obp, 0);
    return { score: ((totalObp / spent) * 1000).toFixed(1), label: 'Moneyball Efficiency Score', sub: 'Total OBP √∑ $ Spent √ó 1000 ¬∑ Higher = Smarter' };
}

const LEVEL_SUCCESS = {
    2: { icon:'üéâ', title:'Perfect Pick!',      body: (sel) => `Players ${sel.join(' + ')} give you the best OBP for the price. You saved money AND got great players!` },
    3: { icon:'üèÜ', title:'You did it!',         body: (sel) => `Players ${sel.join(' + ')} have great OBP within a tight $15M. That's Moneyball thinking!` },
    4: { icon:'üìà', title:'OPS Master!',         body: (sel) => `Players ${sel.join(' + ')} give you the best combined OPS. You looked beyond just OBP ‚Äî that's next-level analysis!` },
    5: { icon:'‚öæ', title:'WAR Genius!',         body: (sel) => `Players ${sel.join(' + ')} maximize team WAR within $24M. You measured players by their TOTAL contribution!` },
    6: { icon:'üèÜ', title:'Championship GM!',    body: (sel) => `Players ${sel.join(' + ')} balance OPS and WAR perfectly within $30M. You built a championship roster like a real GM!` }
};
const LEVEL_ERROR = {
    2: 'Look for the two players with the highest OBP for the lowest price. Stars don\'t matter!',
    3: 'Remember: you only have $15M. Focus on OBP, not home runs or popularity!',
    4: 'Sort by OPS ‚Äî it combines OBP and Slugging. High OBP alone isn\'t enough anymore!',
    5: 'Sort by WAR to see who truly contributes the most. A big HR count doesn\'t mean high WAR!',
    6: 'Balance OPS and WAR together. The biggest star eats too much of your $30M budget!'
};

function checkLevel(level) {
    const ls  = state.levels[level];
    const lv  = LEVELS[level];
    const sel = ls.selected;
    const opt = lv.optimal;
    const isCorrect = opt.every(id => sel.includes(id)) && sel.every(id => opt.includes(id));

    const fb = document.getElementById(`feedback-${level}`);

    if (isCorrect) {
        ls.completed = true;
        const spent = getSpent(level);
        const { score, label, sub } = levelEffScore(level, sel, spent);
        const msg = LEVEL_SUCCESS[level] || LEVEL_SUCCESS[3];

        fb.className = 'feedback-box show success';
        fb.innerHTML = `<div class="fb-icon">${msg.icon}</div>
            <div class="fb-title">${msg.title}</div>
            <div class="fb-body">${msg.body(sel)}</div>`;

        // Efficiency score
        const effBox = document.getElementById(`eff-${level}`);
        effBox.className = 'eff-box show';
        effBox.innerHTML = `<div class="eff-lbl">${label}</div>
            <div class="eff-score">${score}</div>
            <div class="eff-sub">${sub}</div>`;

        // Breakdown
        showBreakdown(level);

        // Disable check button, add next button
        document.getElementById(`check-${level}`).style.display = 'none';
        setTimeout(() => {
            const btns = document.getElementById(`btns-${level}`);
            const nextBtn = document.createElement('button');
            nextBtn.className = 'btn-primary';
            const isLast = level === 6;
            nextBtn.innerHTML = isLast ? 'Get Your Code! ‚Üí' : 'Next Level ‚Üí';
            nextBtn.onclick = () => goToLevel(isLast ? 'final' : level + 1);
            btns.appendChild(nextBtn);
        }, 400);

    } else {
        ls.attempts++;
        state.achievements.firstTry = false;

        fb.className = 'feedback-box show error';
        fb.innerHTML = `<div class="fb-icon">ü§î</div>
            <div class="fb-title">Try again!</div>
            <div class="fb-body">${LEVEL_ERROR[level] || LEVEL_ERROR[3]}</div>`;

        setTimeout(() => {
            ls.selected = [];
            renderPlayers(level);
            renderBudget(level);
            document.getElementById(`check-${level}`).disabled = true;
            fb.classList.remove('show');
        }, 2200);
    }
}

// ‚îÄ‚îÄ‚îÄ BREAKDOWN TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playerValueScore(p, statMode) {
    if (statMode === 'ops')       return ((p.ops / p.salary) * 1000);
    if (statMode === 'war')       return ((p.war / p.salary) * 10);
    if (statMode === 'composite') return (((p.ops + p.war / 10) / p.salary) * 100);
    return ((p.obp / p.salary) * 1000); // default obp
}

function showBreakdown(level) {
    const lv      = LEVELS[level];
    const sel     = state.levels[level].selected;
    const statMode = lv.statMode || 'obp';
    const sorted  = [...lv.players].sort((a, b) => playerValueScore(b, statMode) - playerValueScore(a, statMode));
    const maxVal  = Math.max(...lv.players.map(p => playerValueScore(p, statMode)));

    let titleText, headHTML, rowFn;

    if (statMode === 'ops') {
        titleText = 'üìä Player Value Rankings ‚Äî OPS √∑ Salary √ó 1000';
        headHTML  = `<span></span><span>Player</span><span>OPS</span><span>Salary</span><span>Value Score</span>`;
        rowFn = (p, vs, pct, isPick, isOpt) => `
            <span>${p.emoji}</span>
            <span>Player ${p.id}${isPick ? ' <span style="color:var(--green);font-size:0.75rem">‚úì Your Pick</span>' : ''}${isOpt && !isPick ? ' <span style="color:var(--gold);font-size:0.75rem">‚òÖ Best</span>' : ''}</span>
            <span style="color:${opsColor(p.ops)};font-weight:700">${p.ops.toFixed(3)}</span>
            <span>$${p.salary}M</span>
            <div class="val-bar"><span class="val-num">${vs.toFixed(1)}</span><div class="val-track"><div class="val-fill" style="width:${pct}%"></div></div></div>`;
    } else if (statMode === 'war') {
        titleText = 'üìä Player Value Rankings ‚Äî WAR √∑ Salary √ó 10';
        headHTML  = `<span></span><span>Player</span><span>WAR</span><span>Salary</span><span>Value Score</span>`;
        rowFn = (p, vs, pct, isPick, isOpt) => `
            <span>${p.emoji}</span>
            <span>Player ${p.id}${isPick ? ' <span style="color:var(--green);font-size:0.75rem">‚úì Your Pick</span>' : ''}${isOpt && !isPick ? ' <span style="color:var(--gold);font-size:0.75rem">‚òÖ Best</span>' : ''}</span>
            <span style="color:${warColor(p.war)};font-weight:700">${p.war.toFixed(1)}</span>
            <span>$${p.salary}M</span>
            <div class="val-bar"><span class="val-num">${vs.toFixed(1)}</span><div class="val-track"><div class="val-fill" style="width:${pct}%"></div></div></div>`;
    } else if (statMode === 'composite') {
        titleText = 'üìä Player Value Rankings ‚Äî (OPS + WAR√∑10) √∑ Salary √ó 100';
        headHTML  = `<span></span><span>Player</span><span>OPS</span><span>WAR</span><span>Salary</span><span>Score</span>`;
        rowFn = (p, vs, pct, isPick, isOpt) => `
            <span>${p.emoji}</span>
            <span>Player ${p.id}${isPick ? ' <span style="color:var(--green);font-size:0.75rem">‚úì Your Pick</span>' : ''}${isOpt && !isPick ? ' <span style="color:var(--gold);font-size:0.75rem">‚òÖ Best</span>' : ''}</span>
            <span style="color:${opsColor(p.ops)};font-weight:700">${p.ops.toFixed(3)}</span>
            <span style="color:${warColor(p.war)};font-weight:700">${p.war.toFixed(1)}</span>
            <span>$${p.salary}M</span>
            <div class="val-bar"><span class="val-num">${vs.toFixed(1)}</span><div class="val-track"><div class="val-fill" style="width:${pct}%"></div></div></div>`;
    } else {
        titleText = 'üìä Player Value Rankings ‚Äî OBP √∑ Salary √ó 1000';
        headHTML  = `<span></span><span>Player</span><span>OBP</span><span>Salary</span><span>Value Score</span>`;
        rowFn = (p, vs, pct, isPick, isOpt) => `
            <span>${p.emoji}</span>
            <span>Player ${p.id}${isPick ? ' <span style="color:var(--green);font-size:0.75rem">‚úì Your Pick</span>' : ''}${isOpt && !isPick ? ' <span style="color:var(--gold);font-size:0.75rem">‚òÖ Best</span>' : ''}</span>
            <span style="color:${obpColor(p.obp)};font-weight:700">${p.obp.toFixed(3)}</span>
            <span>$${p.salary}M</span>
            <div class="val-bar"><span class="val-num">${vs.toFixed(1)}</span><div class="val-track"><div class="val-fill" style="width:${pct}%"></div></div></div>`;
    }

    // For composite, use 6-column grid
    const gridCols = statMode === 'composite'
        ? 'grid-template-columns: 36px 1fr 62px 52px 62px 80px;'
        : 'grid-template-columns: 36px 1fr 62px 62px 90px;';

    const rows = sorted.map(p => {
        const vs     = playerValueScore(p, statMode);
        const pct    = Math.round((vs / maxVal) * 100);
        const isPick = sel.includes(p.id);
        const isOpt  = lv.optimal.includes(p.id);
        return `<div class="bd-row${isPick ? ' your-pick' : ''}${isOpt ? ' optimal' : ''}" style="${gridCols}">
            ${rowFn(p, vs, pct, isPick, isOpt)}
        </div>`;
    }).join('');

    const bd = document.getElementById(`breakdown-${level}`);
    bd.className = 'breakdown show';
    bd.innerHTML = `
        <div class="bd-title">${titleText}</div>
        <div class="bd-head" style="${gridCols}">${headHTML}</div>
        ${rows}`;
}

// ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goToLevel(level) {
    const cur  = document.querySelector('.screen.active');
    const next = document.getElementById(level === 'final' ? 'screen-final' : `screen-${level}`);

    if (level !== 'final') state.currentLevel = level;
    else state.currentLevel = 7;

    renderProgress();

    if (cur) {
        cur.classList.remove('visible');
        setTimeout(() => {
            cur.classList.remove('active');
            next.classList.add('active');
            requestAnimationFrame(() => requestAnimationFrame(() => next.classList.add('visible')));
        }, 320);
    } else {
        next.classList.add('active');
        requestAnimationFrame(() => requestAnimationFrame(() => next.classList.add('visible')));
    }

    if (level === 'final') {
        setTimeout(() => {
            renderFinalAchievements();
            launchConfetti();
        }, 400);
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚îÄ‚îÄ‚îÄ ACHIEVEMENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ACHIEVEMENTS = [
    { id: 'complete',  icon: 'üèÜ', label: 'Moneyball Master',  desc: 'Completed all 6 levels'      },
    { id: 'firstTry',  icon: 'üéØ', label: 'Sharp Eye',         desc: 'First try on all 5 drafts'   },
    { id: 'noHints',   icon: 'üß†', label: 'Self-Made Analyst', desc: 'Never used a hint'            },
    { id: 'sixStar',   icon: 'üî¨', label: 'Six Star Analyst',  desc: 'First try + no hints on all 6 levels' }
];

function renderFinalAchievements() {
    const earned = [];
    earned.push('complete'); // always
    if (state.achievements.firstTry) earned.push('firstTry');
    if (state.achievements.noHints)  earned.push('noHints');
    if (state.achievements.firstTry && state.achievements.noHints) earned.push('sixStar');

    const grid = document.getElementById('final-ach-grid');
    grid.innerHTML = ACHIEVEMENTS.filter(a => earned.includes(a.id)).map(a =>
        `<div class="final-ach-badge">${a.icon} ${a.label}</div>`
    ).join('');
}

// ‚îÄ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function launchConfetti() {
    const canvas = document.getElementById('confetti-canvas');
    const ctx    = canvas.getContext('2d');
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;

    const colors = ['#f5a623','#3fb950','#58a6ff','#f85149','#ffffff','#e879f9'];
    const pieces = Array.from({ length: 160 }, () => ({
        x:   Math.random() * canvas.width,
        y:   Math.random() * -canvas.height,
        w:   Math.random() * 10 + 5,
        h:   Math.random() * 6  + 3,
        col: colors[Math.floor(Math.random() * colors.length)],
        rot: Math.random() * 360,
        vx:  Math.random() * 4  - 2,
        vy:  Math.random() * 3  + 2,
        vr:  Math.random() * 5  - 2.5
    }));

    let frame, tick = 0;
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        pieces.forEach((p, i) => {
            p.x  += p.vx; p.y += p.vy; p.rot += p.vr;
            if (p.y > canvas.height + 20) {
                pieces[i] = { ...p, x: Math.random() * canvas.width, y: -20, vy: Math.random() * 2 + 2 };
            }
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot * Math.PI / 180);
            ctx.fillStyle = p.col;
            ctx.globalAlpha = Math.max(0, 1 - tick / 280);
            ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
            ctx.restore();
        });
        tick++;
        if (tick < 300) frame = requestAnimationFrame(draw);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    draw();
}

// ‚îÄ‚îÄ‚îÄ COPY CODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copyCode() {
    navigator.clipboard.writeText('101-M3-L1-MONEYBALL').then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => { btn.textContent = 'üìã Copy Code'; }, 2000);
    }).catch(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = '101-M3-L1-MONEYBALL';
    });
}

// ‚îÄ‚îÄ‚îÄ RESTART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function restartGame() {
    state.currentLevel = 1;
    state.achievements = { firstTry: true, noHints: true };
    state.sortMode = { 2: 'obp', 3: 'obp', 4: 'ops', 5: 'war', 6: 'ops' };
    state.levels = {
        2: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        3: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        4: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        5: { selected: [], hintsShown: 0, attempts: 0, completed: false },
        6: { selected: [], hintsShown: 0, attempts: 0, completed: false }
    };

    // Reset quiz
    document.querySelectorAll('.quiz-opt').forEach(o => o.classList.remove('correct','wrong','locked'));
    document.getElementById('feedback-1').className = 'feedback-box';
    document.getElementById('next-1').style.display = 'none';

    // Reset each draft level
    [2, 3, 4, 5, 6].forEach(lv => {
        renderPlayers(lv);
        renderBudget(lv);

        document.getElementById(`feedback-${lv}`).className = 'feedback-box';
        document.getElementById(`eff-${lv}`).className = 'eff-box';
        document.getElementById(`breakdown-${lv}`).className = 'breakdown';
        document.getElementById(`hint-${lv}`).className = 'hint-box';
        document.getElementById(`hint-btn-${lv}`).style.display = 'inline-block';
        document.getElementById(`hint-btn-${lv}`).textContent = 'üí° Need a Hint?';
        document.getElementById(`check-${lv}`).disabled = true;
        document.getElementById(`check-${lv}`).style.display = 'inline-block';

        // Remove dynamically added next buttons
        const btns = document.getElementById(`btns-${lv}`);
        btns.querySelectorAll('.btn-primary:not(#check-' + lv + ')').forEach(b => b.remove());

        // Reset sort buttons to default active state
        const defaultSort = state.sortMode[lv];
        const keys = SORT_KEYS[lv] || ['obp','salary','stars'];
        keys.forEach(m => {
            const btn = document.getElementById(`sort-${lv}-${m}`);
            if (btn) btn.classList.toggle('active', m === defaultSort);
        });
    });

    renderProgress();

    // Transition to level 1
    const cur  = document.querySelector('.screen.active');
    const next = document.getElementById('screen-1');
    if (cur) {
        cur.classList.remove('visible');
        setTimeout(() => {
            cur.classList.remove('active');
            next.classList.add('active');
            requestAnimationFrame(() => requestAnimationFrame(() => next.classList.add('visible')));
        }, 320);
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
init();
</script>
</body>
</html>
